## 维度数据模型

维度模型是一种趋向于支持最终用户对数据仓库进行查询的设计技术，是围绕性能和易理解性构建的。
> 关系模型对于事务处理系统表现非常出色，但它并不是面向最终用户的

事实和维度是两个维度模型中的核心概念
- 事实表示对业务数据的度量，而维度是观察数据的角度。
- 事实通常是数字类型的，可以进行聚合和计算，而维度通常是一组层次关系或描述信息，用来定义事实
> 销售金额是一个事实，而销售时间、销售的产品、购买的顾客、商店等都是销售事实的维度

两种模式：星型模型、雪花模型

### 1.维度数据模型建模过程
- 选择业务流程
- 声明粒度
    - 在选择维度和事实之前，必须先声明粒度，每个候选维度或事实必须与定义的粒度保持一致
    - 在一个事实所对应的所有维度设计中强制实行粒度一致性是保证数仓性能和易用性的关键
    - 一般会从原始粒度（最低级别的粒度）开始设计
- 确认维度
    - 维度表是事实的基础，说明了事实表的数据从哪里来
    - 典型的维度都是名词，如日期、商店、库存等
    - 维度表存储了某一维度的所有相关的数据
- 确认事实
    - 识别数字化的度量，构成事实表的记录
    - 和用户最相关，用户通过对事实表的访问获取数仓的数据
    - 大部分是数字类型，可累加、可计算
    
### 2. 维度数据模型的特点
- 易理解
- 高性能
    - 维度模型更倾向于非规范化，可以优化查询的性能（范化的实质是减少数据冗余，以优化事务处理或数据更新的性能）
    - 维度设计的整体观点是要简化和加速查询
- 可拓展
    - 维度模型允许数据冗余，更容易容纳不可预料的新增数据

### 3. 星型模式
星型模式将业务流程分为事实和维度。事实包含业务的度量，是定量的数据，如销售价格、销售数量、距离、速度、重量等是事实。维度是对事实数据属性的描述，如日期、产品、客户、地理位置等是维度

#### 3.1 事实表
一般由数字值和指向维度表的外键组成，一般会把事实表的粒度级别设计得比较低

主要有三种类型的事实表
- 事务事实表：记录特定事件的事实，如销售
- 快照事实表：记录给定时间点的事实，比如月底账户余额
- 累积事实表：记录给定时间点的**聚合事实**，如当月总销售额。

#### 3.2 维度表
维度表的记录数通常比事实表少，但每条记录包含有大量用于描述事实数据的属性字段

常用的维度表：
- 时间维度表。
- 地理维度表。描述位置信息的数据，如国家、省份、城市、区县、邮编等。
- 产品维度表
- 人员维度表
- 范围维度表。描述分段数据的信息，如高级、中级、低级等。

通常，维度表会设计一个数字类型的代理键，映射业务数据中的主键

#### 3.3 有点
星型模式是非规范化的，不受应用于事务型关系数据库的范式规则的约束，优点有：
- 简化查询。查询数据时，星型模式的连接逻辑比较简单，而从高度规范化的事务模型查询数据时，往往需要更多的表连接。
- 简化业务报表逻辑。与高度规范化的模式相比，由于查询更简单，因此星型模式简化了普通的业务报表（如每月报表）逻辑。
- 获得查询性能。星型模式可以提升只读报表类应用的性能。
- 快速聚合。基于星型模式的简单查询能够提高聚合操作的性能。
- 便于向立方体提供数据。星型模式被广泛用于高效地建立OLAP立方体，几乎所有的OLAP系统都提供ROLAP模型（关系型OLAP），它可以直接将星型模式中的数据当作数据源，而不用单独建立立方体结构。

#### 3.4 缺点
- 不能保证数据的完整性。一次性地插入或更新操作可能会造成数据异常（在范式规则约束下的关系模型可以避免）
- 对分析需求来说，不够灵活。很难进行全面的数据分析，不能自然的支持业务数据多对多的关系，需要维度表和事实表之间建立桥接表

