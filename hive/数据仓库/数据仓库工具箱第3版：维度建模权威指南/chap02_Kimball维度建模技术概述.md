# Kimball维度建模技术概述

## 2.1 基本概念

- 收集业务需求和数据实现

  - 理解业务需求，理解作为基础的源数据的实际情况

  - 与业务代表交流来发现需求

  - 数据实际情况可以通过与源系统专家交流， 构建高层次数据分析访问数据可行性来揭示

    > 英文版原文：
    >
    > data realities are uncovered by meeting with source system experts and doing high-level data profiling to assess data feasibilities.
    >
    > 理解：
    >
    > - 与业务系统研发交流，理解表结构
    > - 探查业务数据，获得profiling，也就是业务数据知识，比如字段的值域，最大值，最小值

- 协作：维度建模研讨

  - 数据建模师负责具体工作，但维度模型需要由主题专家（数仓人员）和来自业务的数据管理代表共同设计完成
  - 协作上需要开展一系列高级别的交互讨论（非技术细节，毕竟要跟业务代表沟通）
  - 对于业务方的好处：提供了一次丰富业务需求 的机会
  - 协作是模型设计成功的关键，维度模型不应该由不懂业务和业务需求的人来设计

- 维度设计过程（4步骤）

  - 设计期间设计4个主要的决策：
    - （1）选择业务过程
    - （2）声明粒度
    - （3）确认维度
    - （4）确认事实
  - 需要考虑：业务需求、底层数据源
  - 业务数据管理代表也必须参与详细的设计活动，以确保涵盖正确的业务

- 业务过程（Business Processes）

  - 业务过程是组织完成的操作型活动

  - 业务过程事件建立或获取性能度量，并转换为事实表中的事实

    > 事实表中的事实，来自于业务过程的事件，业务行为事件会产生相关的性能指标数据（也就是度量值）

  - 业务过程的选择非常重要，因为业务过程定义了特定的设计目标以及对粒度、维度、事实的定义

    > 这里的选择分两个层面：
    >
    > - 业务过程粒度的选择，也是是否对业务事件做抽象。
    >   - 比如”安全处置“，处置的动作可以是封禁、不推荐。那么”处置“实际上就是一系列处置动作的抽象。而封禁也可以作为业务过程，只不过是更细粒度的业务过程。
    > - 覆盖的业务环节的选择。比如评级会涉及到送审、人工打标、打标结果聚合，那么业务过程可以有：
    >   - 评级结果：覆盖评级结果的聚合环节
    >   - 评级送审：覆盖数据送审、人工打标两个环节
    >
    > 业务过程一旦选择好了，就意味着设计目标也基本确定，粒度和维度、事实的定义也相应的有了定义的轮廓

  - 每个业务过程对应企业数据仓库总线矩阵的一行

- 粒度（Grain）

  - 声明粒度是维度设计的重要步骤，也是设计过程必须遵守的协议（contract）

  - 在选择维度或事实前必须声明粒度，因为每个**候选维度或事实**必须与定义的粒度保持一致

    > 比如账户粒度下，账户信息等维度可以和账户余额等事实存一个表中
    >
    > 但在客户粒度下，账户信息就不能存在了

    > 维度与维度之间，是存在粒度信息的，设计上要注意

  - 在所有维度设计中**强制实行一致性是保证BI应用性能和易用性的关键**

  - 实践上建议：

    - 从原子级别粒度数据开始设计
    - 上卷粒度对于数仓的性能调整非常重要，但需要猜测业务公共问题
    - 针对不同粒度的事实表，需要建立不同的物理表，同一事实表不能混用不同粒度

- 描述环境的维度

  - 维度提供围绕某一业务过程事件所涉及的 “ 谁、什么、何处、何时、为什么、如何” 等背景

  - 维度表包含B1应用所需要的用于**过滤及分类**事实的描述性属性

  - 牢牢掌握事实表 的粒度，就能够将所有可能存在的维度区分开

    > 怎么理解？

  - 当与给定事实表行关联时，任何情况下都应使维度保持单一值

    > 怎么理解？

  - 维度表有时被称为数仓的”灵魂“，因为维度能够被用作业务分析的入口和描述性标识

- 用于度量的事实

  - 事实涉及来自业务过程事件的度量，基本上都是数量值

  - 事实表对应一个物理可观察的事件：一个事实表行与按照事实表粒度描述的度量事件之间存在一对一关系

    > 再加深理解

  - 在事实表内，所有事实只允许与声明的粒度保持一致

- 星型模式与OLAP 多维数据库

  - 星型模式是部署在**关系型数据库**之上的多维结构（事实表+通过主/外键关联的维度表）
  - OLAP多维数据库是实现在**多维数据库**之上的多维结构，与关系型星型模式内容等价，或者说来源于关系型星星模式
  - OLAP多维数据库能够使用具有比SQL语言具有更强分析能力的语言访问

- （数据变化可以）方便地扩展到维度模型

  - 维度模型对数据关系发生变化具有灵活的适应性

    -  当事实与存在的事实表粒度一致时，可以创建新列。

    - 通过建立新的外键列，可以将维度关联到己经存在的事实表上，前提是维度列与事实表粒度保持一致。

    - 可以在维度表上通过建 立新列添加属性。

    - 可以使事实表的粒度更原子化，方法是在维度表上增加属性，然后以更细的粒度重置事实表，小心保存事实表及维度表的列名。

      > 通过在维度表新建一个字段X，然后新建一个粒度更低的事实表，并将新加的字段X作为新事实表的外键？

## 2.2 事实表技术基础






## 2.3 维度表技术基础

 概念 | 定义 | 使用场景 | 示例 
--- | --- |---| --- 
维度代理键 |
自然键、持久键和超自然键 |
退化维度 | 
非规范化扁平维度 |将非规范化的多对一固定深度层次引入扁平维度行的不同属性
多层次维度 | | | 日、周、月、年；区、市、省
维度表中的空值属性 | 推荐采用描达性字符串替代空值 | 应该避免在维度属性中使用空值，因为不同的数据库系统在处理分组和约束时，针对空值的处理方法不一致| 例如，使用 Unknown或Not Applicable 替换空值。
日历日期维度 | 
扮演角色的维度 |
杂项维度 |
雪花维度 | 扁平化的、非规范化的维度表完全能够获得与雪花模式相同的信息
支架维度 | 


## 2.4 使用一致性维度集成

