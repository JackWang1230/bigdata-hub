## Kylin

#### 1、概述
初衷：解决千亿、万亿条记录的秒级查询问题，其中的关键是打破查询时间随数据量呈线性增长的规律

> 大规模并行计算（MPP）和列式存储虽然提高了计算和存储的速度，但是没有改变查询时间与数据量呈线性增长的关系这一事实

两个事实：
- 大数据查询一般要的是统计结构，是聚合计算后的统计值。原始数据访问得很少
- 聚合是按维度进行的，而维度的聚合可能性也是有限的，一般不随数据的膨胀而线性增长

“预计算”就是Kylin在“大规模并行处理”和“列式存储”之外，提供给大数据分析的第三个关键技术。

#### 2、工作原理
本质上是：MOLAP（Multidimensional Online AnalyticalProcessing）Cube，也就是多维立方体分析

维度（dimension）和度量（measure）：数据分析中的两个基本概念
> 维度具有层级概念

Cube和Cuboid
> 给定一个数据模型，我们可以对其上所有维度进行组合。对于N个维度来说，所有组合的可能性有2^N种。对每一种维度的组合，将度量做聚合运算，运算的结果保存为一个物化视图，称为Cuboid。将所有维度组合的Cuboid作为一个整体，被称为Cube。所以简单来说，一个Cube就是许多按维度聚合的物化视图的集合
- Cube（或称Data Cube），即数据立方体，是一种常用于数据分析与索引的技术，它可以对原始数据建立多维度索引，大大加快数据的查询效率。
- Cuboid特指Apache Kylin中在某一种维度组合下所计算的数据。
- Cube Segment指针对源数据中的某一片段计算出来的Cube数据。通常，数据仓库中的数据数量会随时间的增长而增长，而Cube Segment也是按时间顺序构建的

Apache Kylin的工作原理就是对数据模型做Cube预计算，并利用计算的结果加速查询。过程如下：
- 指定数据模型，定义维度和度量。
- 预计算Cube，计算所有Cuboid并将其保存为物化视图。
- 执行查询时，读取Cuboid，进行加工运算产生查询结果。

Apache Kylin v1.5版本引入了“可扩展架构”的概念，将主要的三部分抽象为接口，方便拓展
- 数据源：默认为Hive，也可以为Kafka
- Cube构建引擎：默认为MapReduce，可以为Spark、Flink
- 存储引擎：默认为HBase

#### 3. 特点
- 标准SQL接口。以Cube技术为核心，对外却没有选用MDX（MultiDimensionaleXpression）作为接口，而是用标准SQL
- 支持超大数据集
> 理论上，Kylin可以支撑的数据集大小没有上限，仅受限于存储系统和分布式计算系统的承载能力。Kylin在数据集规模上的局限性主要在于维度的个数和基数。它们一般由数据模型决定
- 亚秒级响应
- 可伸缩性和高吞吐率


#### 4. 使用Kylin的要求
- Apache Kylin既支持星形数据模型，也支持雪花数据模型。其他模型需要通过一定的转换